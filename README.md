# Xcribe

[![GitHub Workflow Status](https://img.shields.io/github/workflow/status/brainnco/xcribe/CI?style=flat-square)](https://github.com/brainnco/xcribe/actions?query=workflow%3ACI)
[![Hex.pm](https://img.shields.io/hexpm/v/xcribe?style=flat-square)](https://hex.pm/packages/xcribe)
[![Hex.pm](https://img.shields.io/hexpm/l/xcribe?style=flat-square)](https://hex.pm/packages/xcribe)
[![Hex.pm](https://img.shields.io/hexpm/dt/xcribe?style=flat-square)](https://hex.pm/packages/xcribe)
[![codecov](https://img.shields.io/codecov/c/github/brainnco/xcribe?style=flat-square)](https://codecov.io/gh/brainnco/xcribe)

Xcribe is a doc generator for Rest APIs built with Phoenix. The documentation is generated by the test specs.

Currently both Blueprint and Swagger (OpenAPI Spec 3.0) syntax are supported. In the future other formats will
be added.

## Installation

Add Xcribe to your application

mix.exs

```elixir
def deps do
  [
    {:xcribe, "~> 1.0.0"}
  ]
end
```

Update deps

```sh
mix deps.get
```

To run `mix xcribe.doc` you must configure `preferred_cli_env: ["xcribe.doc": :test]` on your mix.ex file.

## Usage

Xcribe generates documentation from `Plug.Conn` struct used on your tests. To
document a route you need pass the `conn` struct to macro `document`.

First you need import `Xcribe.Document` macro in your `ConnCase` file (usally located in `/test/support/conn_case.ex`).
Doing that, `document/2` macro will be available into your test specs.

/test/support/conn_case.ex

```elixir
defmodule YourAppWeb.ConnCase do
  use ExUnit.CaseTemplate

  using do
    quote do
     ...
      # import Xcribe `document/2` macro
      import Xcribe.Document
     ...
    end
  end
end
```

Now in your tests you should call the macro `document` with the conn struct

```elixir
test "get posts", %{conn: conn} do

  response =
    conn
    |> get("/posts")
    |> document()
    |> json_response(200)

  assert response == []
end
```

See more about document macro `Xcribe.Document`

### Generating documetation file

By Xcribe task:

```sh
mix xcribe.doc
```

See `Mix.Tasks.Xcribe.Doc` for more details.

You can also run Xcribe while runing `mix test`, see `Xcribe.Formatter`.

### Rendering HTML

The output file is write in Blueprint sintax. To render to HTML you can use the
tools listed at [APIBLUEPRINT.ORG](https://apiblueprint.org/tools.html#renderers)

If Swagger format is configured, [Swagger UI](https://swagger.io/tools/swagger-ui/download/) can be used to display Swagger documentation.

## Configure

You can add this configurations to your `config/test.ex`

- output: a custom name to the output file
- format: ApiBlueprint or Swagger formats
- json_library: The library to be used for json decode/encode.
- serve: Enables Xcribe serve mode. See more in `Serving doc` session.
- specification_source: a custom path to specification file. See `Xcribe.Specification`

Example

```elixir
config :xcribe, YourAppWeb.Endpoint,
  output: "openapi.json",
  format: :swagger # or :api_blueprint,
  json_library: Jason,
  specification_source: ".xcribe.exs"
```

See `Xcribe` to more configuration options.

### Serve documentation

[Serve doc](documentation/serving_doc.md)

## Contributing

[Contributing Guide](CONTRIBUTING.md)

## Changelog

[Changelog](CHANGELOG.md)

## License

[Apache License, Version 2.0](LICENSE) Â© [brainn.co](https://github.com/brainnco)
